<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>7.0</version>
    <template_groups>
        <template_group>
            <uuid>3b2953c35b174dd0bffc9288d3b2b796</uuid>
            <name>Серверное оборудование</name>
        </template_group>
    </template_groups>
    <templates>
        <template>
            <uuid>9dad7eb9ea284bdabc6c12884438c64d</uuid>
            <template>Lenovo ThinkSystem SR670 API</template>
            <name>Lenovo ThinkSystem SR670 API</name>
            <groups>
                <group>
                    <name>Серверное оборудование</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>1a2053de70694814afc27430439e58c7</uuid>
                    <name>Redfish Chassis Discovery</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.chassis.inventoryraw</key>
                    <delay>5m</delay>
                    <history>3d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1/Memory</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <uuid>b1ea784b9e37447e80907be6bb2c1768</uuid>
                    <name>Chassis FruPartNumber</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.frupartnumber</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Oem.Lenovo.FruPartNumber</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>frupartnumber</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>0d3a24d3bf1a407f94c219474f0b9716</uuid>
                    <name>Chassis Location</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.location</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Location.PostalAddress.Location</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>location</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>db4b47f4a5df481eba8c996c535d1903</uuid>
                    <name>Chassis Location Contacts</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.locationcontacts</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Location.Contacts.ContactName</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>locationcontacts</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>d964a23fec2b44e9958708ac4828823f</uuid>
                    <name>Chassis Location Name</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.locationname</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Location.PostalAddress.Name</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>locationname</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>3817e3521480468d8fd1144ac25955ff</uuid>
                    <name>Chassis Location Rack</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.locationrack</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Location.Placement.Rack</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>locationrack</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>b7b66c48da9144c0b37b42cd9b54d7f1</uuid>
                    <name>Chassis Location RackOffset</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.locationrackoffset</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Location.Placement.RackOffset</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>locationrackoffset</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>b3afd452161046418dfe68ee3b199fba</uuid>
                    <name>Chassis Location Room</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.locationroom</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Location.PostalAddress.Room</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>locationroom</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9a0263d13ac74b4bb1b08e2bbe566cbf</uuid>
                    <name>Chassis PartNumber</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.partnumber</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.PartNumber</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>partnumber</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>eca9158813fa4c4486058ba3a5ffc345</uuid>
                    <name>Chassis SKU</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.sku</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.SKU</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>sku</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>19f7f006b3f84732bc9f1114eff29115</uuid>
                    <name>Chassis SystemBoardSerialNumber</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.chassis.systemboardserialnumber</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Oem.Lenovo.SystemBoardSerialNumber</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Chassis/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>systemboardserialnumber</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9befe3e5a0f14f03af92042df3253a3a</uuid>
                    <name>Server HostName</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.hostname</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.HostName</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>cpu</tag>
                            <value>statushealth</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>bd7425c126b641ef8aa2d490cd357266</uuid>
                    <name>Server MemorySummary</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.memorysummary</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.MemorySummary.TotalSystemMemoryGiB</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>memory</tag>
                            <value>memorysummary</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>41e35771597848c1a911e2d7b224f15a</uuid>
                    <name>Server Model</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.model</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.Model</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>cpu</tag>
                            <value>model</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>b17b670134504fe585f2b1fafc6469dc</uuid>
                    <name>Server PowerState</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.powerstate</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.PowerState</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>cpu</tag>
                            <value>powerstate</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>d20fa7f328d5488c896eedfdacb06a23</uuid>
                    <name>Server ProcessorModel</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.processormodel</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.ProcessorSummary.Model</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>cpu</tag>
                            <value>processormodel</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>2b8990a0d3ae4d00b6f6c8641c82d1c8</uuid>
                    <name>Server SerialNumber</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.serialnumber</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.SerialNumber</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>cpu</tag>
                            <value>serialnumber</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>6d221dbe46a64b00b9539773640701b3</uuid>
                    <name>Server StatusHealth</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.statushealth</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.ProcessorSummary.Status.Health</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>cpu</tag>
                            <value>statushealth</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>5fd587a381cd4a80a988b498c28befbb</uuid>
                    <name>Server StatusState</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.inventory.statusstate</key>
                    <delay>5m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.ProcessorSummary.Status.State</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>cpu</tag>
                            <value>statusstate</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9c11002758584b65901299a9254b6f18</uuid>
                    <name>Redfish Memory Discovery</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.memory.collection.raw</key>
                    <delay>5m</delay>
                    <history>3d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1/Memory</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <uuid>896149743be74a5290c08eb5502d6647</uuid>
                    <name>Redfish Network Discovery</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.network.inventoryraw</key>
                    <delay>5m</delay>
                    <history>3d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}redfish/v1/Systems/1/EthernetInterfaces</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
                <item>
                    <uuid>9818244001fe4476884195902e3fd33f</uuid>
                    <name>Redfish RAID Health Discovery</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.raid.health</key>
                    <delay>5m</delay>
                    <history>3d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.body.StorageControllers[0].Status.Health</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1/Storage/RAID_Slot1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                    <tags>
                        <tag>
                            <tag>chassis</tag>
                            <value>raid</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>d82d98f34b8e4b92be0e7b11cd2744b8</uuid>
                            <expression>last(/Lenovo ThinkSystem SR670 API/redfish.raid.health)=&quot;Critical&quot;</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>last(/Lenovo ThinkSystem SR670 API/redfish.raid.health)=&quot;OK&quot;</recovery_expression>
                            <name>Redfish RAID Health is Critical</name>
                            <priority>DISASTER</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>af7ab2f033944a199664822652dc89c8</uuid>
                    <name>Redfish Storage Discovery</name>
                    <type>HTTP_AGENT</type>
                    <key>redfish.storage.raid_slot10.raw</key>
                    <delay>5m</delay>
                    <history>1d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$API_USER}</username>
                    <password>{$API_PASSWORD}</password>
                    <timeout>30s</timeout>
                    <url>https://{HOST.CONN}/redfish/v1/Systems/1/Storage/RAID_Slot1</url>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                    </headers>
                    <output_format>JSON</output_format>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>9866980a34fc430eb0cbf747052d09d0</uuid>
                    <name>Redfish Drives Discovery</name>
                    <type>DEPENDENT</type>
                    <key>redfish.drives.discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>83600a172ce640abb23d49c1b9b973ba</uuid>
                            <name>Drive {#DRIVE.NAME}: Drive Status</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.drivestatus[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Oem.Lenovo.DriveStatus || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>status</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>2246eb1b24f645c0a0090f8a7125a5c7</uuid>
                                    <expression>last(/Lenovo ThinkSystem SR670 API/redfish.drive.drivestatus[{#DRIVE.NAME}])&lt;&gt;&quot;Online&quot;</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>last(/Lenovo ThinkSystem SR670 API/redfish.drive.drivestatus[{#DRIVE.NAME}])=&quot;Online&quot;</recovery_expression>
                                    <name>Drive {#DRIVE.NAME}: Disk status has changed</name>
                                    <priority>AVERAGE</priority>
                                    <description>Disk status has changed!</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>disk</tag>
                                            <value>trigger_status</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <uuid>cd49cb7e3c1d4ee49568035d5601c8d9</uuid>
                                    <expression>nodata(/Lenovo ThinkSystem SR670 API/redfish.drive.drivestatus[{#DRIVE.NAME}],20m)=1</expression>
                                    <name>Drive {#DRIVE.NAME}: No data received for 20 minutes</name>
                                    <priority>AVERAGE</priority>
                                    <description>Не получены данные о статусе диска {#DRIVE.NAME} в течение 20 минут.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>disk</tag>
                                            <value>trigger_status</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <uuid>827fa61234b9473d81ddd8f3185f6716</uuid>
                                    <expression>change(/Lenovo ThinkSystem SR670 API/redfish.drive.drivestatus[{#DRIVE.NAME}])&lt;&gt;0</expression>
                                    <name>Drive {#DRIVE.NAME}: Status has changed</name>
                                    <priority>AVERAGE</priority>
                                    <description>Статус диска {#DRIVE.NAME} изменился

Предыдущий статус: {ITEM.LASTVALUE2}
Новый статус: {ITEM.LASTVALUE1}
Время изменения: {EVENT.TIME} {EVENT.DATE}</description>
                                    <tags>
                                        <tag>
                                            <tag>disk</tag>
                                            <value>trigger_status</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>41cd20d75958478280841b30efe92341</uuid>
                            <name>Drive {#DRIVE.NAME}: Status Health</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.health[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Status.Health || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>health</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>f57cd60516a6415a9da23a771824eb87</uuid>
                                    <expression>last(/Lenovo ThinkSystem SR670 API/redfish.drive.health[{#DRIVE.NAME}])=&quot;Critical&quot;</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>last(/Lenovo ThinkSystem SR670 API/redfish.drive.health[{#DRIVE.NAME}])&lt;&gt;&quot;Critical&quot;</recovery_expression>
                                    <name>Drive {#DRIVE.NAME}: Disk health is Critical</name>
                                    <priority>DISASTER</priority>
                                    <description>КРИТИЧНО: Диск {#DRIVE.NAME} находится в состоянии Critical!

Требуется немедленная проверка оборудования!</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>disk</tag>
                                            <value>health</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <uuid>a3d551fea23a47c0b7678480796147b9</uuid>
                                    <expression>last(/Lenovo ThinkSystem SR670 API/redfish.drive.health[{#DRIVE.NAME}])=&quot;Warning&quot;</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>last(/Lenovo ThinkSystem SR670 API/redfish.drive.health[{#DRIVE.NAME}])&lt;&gt;&quot;Warning&quot;</recovery_expression>
                                    <name>Drive {#DRIVE.NAME}: Disk health is Warning</name>
                                    <priority>HIGH</priority>
                                    <description>КРИТИЧНО: Диск {#DRIVE.NAME} находится в состоянии Warning!

Требуется немедленная проверка оборудования!</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>disk</tag>
                                            <value>warning</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>7467fc7ec05b49a481070ee282c72716</uuid>
                            <name>Drive {#DRIVE.NAME}: Interface</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.interface[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Protocol || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>Interface</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>e23e2ab6f2f9493d8859a971587bed5b</uuid>
                            <name>Drive {#DRIVE.NAME}: LifeLeftPercent</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.lifeleftpercent[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.PredictedMediaLifeLeftPercent || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>lifeleftpercent</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>a554654283c04d268ae9dd6589a39c6b</uuid>
                            <name>Drive {#DRIVE.NAME}: Location</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.location[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.PhysicalLocation.Info || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>location</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>923af8fb30cd4e109e9631bf8111281e</uuid>
                            <name>Drive {#DRIVE.NAME}: Manufacturer</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.manufacturer[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Manufacturer || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>manufacturer</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>2a1d68e01af540dd9c2b1424b8bdb1c4</uuid>
                            <name>Drive {#DRIVE.NAME}: Model</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.model[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Model || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>model</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>e3638c7300414836b516a8e2398f5a5d</uuid>
                            <name>Drive {#DRIVE.NAME}: Name</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.name[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Name || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>name</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>7dd0a225f1cc49c08f4c4dbf2000719f</uuid>
                            <name>Drive {#DRIVE.NAME}: Part Number</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.partnumber[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.PartNumber || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>partnumber</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>a453f606a2a340e38ac19b4f20aa0ef8</uuid>
                            <name>Drive {#DRIVE.NAME} Raw Data</name>
                            <type>HTTP_AGENT</type>
                            <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            <delay>5m</delay>
                            <history>1d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <authtype>BASIC</authtype>
                            <username>{$API_USER}</username>
                            <password>{$API_PASSWORD}</password>
                            <timeout>30s</timeout>
                            <url>https://{HOST.CONN}{#DRIVE.URL}</url>
                            <headers>
                                <header>
                                    <name>Accept</name>
                                    <value>application/json</value>
                                </header>
                            </headers>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>data</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>e94a5fb206fe451fb22fac186872ce74</uuid>
                            <name>Drive {#DRIVE.NAME}: Serial Number</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.serialnumber[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.SerialNumber || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>serialnumber</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>29d28255391a498cb7ebdd71fcabc1cd</uuid>
                            <name>Drive {#DRIVE.NAME}: Size</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.size[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.CapacityBytes || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>size</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9e77231e8127451682833eca60363e2a</uuid>
                            <name>Drive {#DRIVE.NAME}: SKU</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.sku[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.SKU || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>sku</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9f10d03788194e20b707d9ba81c61289</uuid>
                            <name>Drive {#DRIVE.NAME}: Status State</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.state[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Status.State || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>state</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9e6e4969446641d0baf1ca9d1cfef82f</uuid>
                            <name>Drive {#DRIVE.NAME}: Temperature</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.temperature[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Oem.Lenovo.Temperature || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>temperature</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>16963bf34a7b44b3bfea7d186535d299</uuid>
                            <name>Drive {#DRIVE.NAME}: Type</name>
                            <type>DEPENDENT</type>
                            <key>redfish.drive.type[{#DRIVE.NAME}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.MediaType || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.drive.raw[{#DRIVE.NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>disk</tag>
                                    <value>type</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>redfish.storage.raid_slot10.raw</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>try {
    var data = JSON.parse(value);

    if (data.body) {
        data = data.body;
    }
    
    var result = [];

    if (!data.Drives || !Array.isArray(data.Drives)) {
        throw new Error('Drives array not found');
    }

    data.Drives.forEach(function(drive, index) {
        if (!drive['@odata.id']) {
            return;
        }
        
        var url = drive['@odata.id'];

        var urlParts = url.split('/');
        var diskName = urlParts[urlParts.length - 1];
        var diskNumber = diskName.replace('Disk.', '');
        
        result.push({
            &quot;{#DRIVE.URL}&quot;: url,
            &quot;{#DRIVE.NAME}&quot;: diskName,
            &quot;{#DRIVE.NUMBER}&quot;: diskNumber,
            &quot;{#DRIVE.FULLURL}&quot;: &quot;https://{HOST.CONN}&quot; + url
        });
    });
    
    return JSON.stringify(result);
    
} catch (e) {
    return JSON.stringify([]);
}</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>1ebe48821c5a4287994dae4a84f3a0cd</uuid>
                    <name>Redfish Ethernet Discovery</name>
                    <type>DEPENDENT</type>
                    <key>redfish.ethernet.discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>847f926919424f6a8fa4307867bbac25</uuid>
                            <name>Network NIC {#ETHERNET.ID}: LinkHealth</name>
                            <type>DEPENDENT</type>
                            <key>redfish.ethernet.health[{#ETHERNET.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Status.Health || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.ethernet.raw[{#ETHERNET.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>ethernet</tag>
                                    <value>linkhealth</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>51814cafcfa54d39b0ec1ff30b229e53</uuid>
                            <name>Network NIC {#ETHERNET.ID}: MACAddress</name>
                            <type>DEPENDENT</type>
                            <key>redfish.ethernet.mac[{#ETHERNET.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.MACAddress || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.ethernet.raw[{#ETHERNET.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>ethernet</tag>
                                    <value>mac</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>233b24c6a50f4c7a89db7de6ec5e2aaf</uuid>
                            <name>Ethernet {#ETHERNET.ID} Raw Data</name>
                            <type>HTTP_AGENT</type>
                            <key>redfish.ethernet.raw[{#ETHERNET.ID}]</key>
                            <delay>5m</delay>
                            <history>1d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <authtype>BASIC</authtype>
                            <username>{$API_USER}</username>
                            <password>{$API_PASSWORD}</password>
                            <timeout>30s</timeout>
                            <url>https://{HOST.CONN}{#ETHERNET.URL}</url>
                            <headers>
                                <header>
                                    <name>Accept</name>
                                    <value>application/json</value>
                                </header>
                            </headers>
                            <tags>
                                <tag>
                                    <tag>ethernet</tag>
                                    <value>data</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>dfbb2278d2b844e68f8ca8e3c8328a2b</uuid>
                            <name>Network NIC {#ETHERNET.ID}: LinkState</name>
                            <type>DEPENDENT</type>
                            <key>redfish.ethernet.state[{#ETHERNET.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Status.State || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.ethernet.raw[{#ETHERNET.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>ethernet</tag>
                                    <value>linkstate</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>96f83ffd2e4a40e1bffb6d078072d901</uuid>
                            <name>Network NIC {#ETHERNET.ID}: LinkStatus</name>
                            <type>DEPENDENT</type>
                            <key>redfish.ethernet.type[{#ETHERNET.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.LinkStatus || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.ethernet.raw[{#ETHERNET.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>ethernet</tag>
                                    <value>linkstatus</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>redfish.network.inventoryraw</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>try {
    var data = JSON.parse(value);
    
    if (data.body) {
        data = data.body;
    }
    
    var result = [];
    if (!data.Members || !Array.isArray(data.Members)) {
        throw new Error('Members array not found');
    }
    
    data.Members.forEach(function(member, index) {
        if (!member['@odata.id']) {
            return; // Пропускаем элементы без URL
        }
        
        var url = member['@odata.id'];
        
        if (!url) return; // Пропускаем пустые URL
        
        // Удаляем завершающий слеш и разбиваем
        url = url.replace(/\/$/, '');
        var urlParts = url.split('/').filter(function(part) {
            return part !== ''; // Убираем пустые элементы
        });
        
        var ethernetId = urlParts[urlParts.length - 1];
        
        // Если ID всё равно пустой, используем индекс
        if (!ethernetId) {
            ethernetId = String(index + 1);
        }
        
        result.push({
            &quot;{#ETHERNET.URL}&quot;: url,
            &quot;{#ETHERNET.ID}&quot;: ethernetId,
            &quot;{#ETHERNET.NAME}&quot;: &quot;Memory Slot &quot; + ethernetId
        });
    });
    
    return JSON.stringify(result);
    
} catch (e) {
    // Для отладки можно вернуть ошибку
    return JSON.stringify([]);
}</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>b7788f780ae74f9fa7b582226a917c7c</uuid>
                    <name>Redfish Memory Discovery</name>
                    <type>DEPENDENT</type>
                    <key>redfish.memory.discovery</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>3783b693d49c439a97f94f62a819640c</uuid>
                            <name>Memory Slot {#MEMORY.ID}: Frequency</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.frequency[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.AllowedSpeedsMHz || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>frequency</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>3f3878e4eb7e4a4aaffd68f1e102e144</uuid>
                            <name>Memory Slot {#MEMORY.ID}: Health</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.health[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Status.Health || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>health</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>4b571ad12fe247b8b30c6c7b295674a1</uuid>
                            <name>Memory Slot {#MEMORY.ID}: Location</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.location[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.MemoryLocation.Slot || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>location</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9ab08f66659e4b52b88489af226347d9</uuid>
                            <name>Memory Slot {#MEMORY.ID}: Manufacturer</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.manufacturer[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Manufacturer || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>manufacturer</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>db78496cb25244d08d4438106b0a0d21</uuid>
                            <name>Memory Slot {#MEMORY.ID}: MemoryMedia</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.memorymedia[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.MemoryMedia || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>memorymedia</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>0a9753bde4684314bb88926f2ded019a</uuid>
                            <name>Memory Slot {#MEMORY.ID}: Name</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.name[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Name || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>name</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>5ccf9edac1a641c4a19f76074e4a353a</uuid>
                            <name>Memory Slot {#MEMORY.ID}: PartNumber</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.partnumber[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.PartNumber || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>partnumber</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>cc1a235a49684345b08b1c2af13b2f47</uuid>
                            <name>Memory {#MEMORY.ID} Raw Data</name>
                            <type>HTTP_AGENT</type>
                            <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            <delay>5m</delay>
                            <history>1d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <authtype>BASIC</authtype>
                            <username>{$API_USER}</username>
                            <password>{$API_PASSWORD}</password>
                            <timeout>30s</timeout>
                            <url>https://{HOST.CONN}{#MEMORY.URL}</url>
                            <headers>
                                <header>
                                    <name>Accept</name>
                                    <value>application/json</value>
                                </header>
                            </headers>
                            <output_format>JSON</output_format>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>data</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>ed9af2af2abd490ea777db4104b1afc1</uuid>
                            <name>Memory Slot {#MEMORY.ID}: SerialNumber</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.serialnumber[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.SerialNumber || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>serialnumber</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>af4b3238df0e40f2a1f6d55d6c3b9ef0</uuid>
                            <name>Memory Slot {#MEMORY.ID}: Size</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.size[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.CapacityMiB || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>size</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>f9a6d87dc30e4945b05289a4c44b545a</uuid>
                            <name>Memory Slot {#MEMORY.ID}: State</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.state[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.Status.State || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>state</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>0a040762935149e18b2651e4ceb4099f</uuid>
                            <name>Memory Slot {#MEMORY.ID}: Type</name>
                            <type>DEPENDENT</type>
                            <key>redfish.memory.type[{#MEMORY.ID}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>var data = JSON.parse(value);

if (data.body) {
    data = data.body;
}

return data.MemoryDeviceType || &quot;Unknown&quot;;</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>redfish.memory.raw[{#MEMORY.ID}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>memory</tag>
                                    <value>type</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>redfish.memory.collection.raw</key>
                    </master_item>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>try {
    var data = JSON.parse(value);
    
    if (data.body) {
        data = data.body;
    }
    
    var result = [];
    if (!data.Members || !Array.isArray(data.Members)) {
        throw new Error('Members array not found');
    }
    
    data.Members.forEach(function(member, index) {
        if (!member['@odata.id']) {
            return;
        }
        
        var url = member['@odata.id'];
        
        if (!url) return;

        url = url.replace(/\/$/, '');
        var urlParts = url.split('/').filter(function(part) {
            return part !== '';
        });
        
        var memoryId = urlParts[urlParts.length - 1];
        
        result.push({
            &quot;{#MEMORY.URL}&quot;: url,
            &quot;{#MEMORY.ID}&quot;: memoryId,
            &quot;{#MEMORY.NAME}&quot;: &quot;Memory Slot &quot; + memoryId
        });
    });
    
    return JSON.stringify(result);
    
} catch (e) {
    return JSON.stringify([]);
}</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$API_PASSWORD}</macro>
                    <value>password</value>
                </macro>
                <macro>
                    <macro>{$API_USER}</macro>
                    <value>username</value>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>
